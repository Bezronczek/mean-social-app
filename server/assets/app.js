"use strict";angular.module("social",["ngRoute"]),angular.module("social").service("PostsSvc",["$http",function(o){this.fetch=function(){return o.get("/api/posts")},this.create=function(t){return o.post("/api/posts",t)}}]),angular.module("social").service("UserSvc",["$http",function(o){var t=this;t.getUser=function(){return o.get("/api/users")},t.login=function(n,e){return o.post("/api/sessions",{username:n,password:e}).then(function(n){return t.token=n.data,o.defaults.headers.common["X-Auth"]=n.data,t.getUser()})},t.createUser=function(n,e){return o.post("/api/users",{username:n,password:e}).then(function(o){return t})}}]),angular.module("social").controller("PostsCtrl",["$scope","PostsSvc",function(o,t){t.fetch().success(function(t){o.posts=t}),o.addPost=function(){o.postBody&&t.create({username:"bezronczek",body:o.postBody}).success(function(t){o.postBody=null})},o.$on("ws:new_post",function(t,n){o.$apply(function(){o.posts.unshift(n)})})}]),angular.module("social").controller("LoginCtrl",["$scope","$location","UserSvc",function(o,t,n){o.login=function(e,r){n.login(e,r).then(function(n){o.$emit("login",n.data),t.path("/")})}}]),angular.module("social").controller("RegisterCtrl",["$scope","$location","UserSvc",function(o,t,n){o.register=function(e,r){n.createUser(e,r).then(function(s){n.login(e,r).then(function(t){return o.$emit("login",t.data)}).then(function(){o.username=null,o.password=null,t.path("/")})})}}]),angular.module("social").controller("ApplicationCtrl",["$scope",function(o){o.$on("login",function(t,n){o.currentUser=n})}]),angular.module("social").config(["$routeProvider","$locationProvider",function(o,t){o.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}),t.html5Mode(!0)}]),angular.module("social").run(["$rootScope","$timeout",function(o,t){!function n(){var e="ws://localhost:3000",r=new WebSocket(e);r.onclose=function(o){console.log("WebSocket connection lost. Reconnecting..."),t(n,1e4)},r.onmessage=function(t){var n=t.data,e=JSON.parse(n),r=e.topic,s=e.payload;o.$broadcast("ws:"+r,s)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvcmUvc29jaWFsLm1vZHVsZS5qcyIsInBvc3RzL3Bvc3RzLnNlcnZpY2UuanMiLCJ1c2Vycy91c2VyLnNlcnZpY2UuanMiLCJwb3N0cy9wb3N0cy5jb250cm9sbGVyLmpzIiwidXNlcnMvbG9naW4uY29udHJvbGxlci5qcyIsInVzZXJzL3JlZ2lzdGVyLmNvbnRyb2xsZXIuanMiLCJjb3JlL2FwcGxpY2F0aW9uLmNvbnRyb2xsZXIuanMiLCJyb3V0ZXMuanMiLCJ3ZWJzb2NrZXRzLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZmV0Y2giLCJnZXQiLCJjcmVhdGUiLCJwb3N0Iiwic2VsZiIsImdldFVzZXIiLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJ0aGVuIiwidmFsIiwidG9rZW4iLCJkYXRhIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwiY3JlYXRlVXNlciIsInJlc3AiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiUG9zdHNTdmMiLCJzdWNjZXNzIiwicG9zdHMiLCJhZGRQb3N0IiwicG9zdEJvZHkiLCJib2R5IiwiJG9uIiwiXyIsIiRhcHBseSIsInVuc2hpZnQiLCIkbG9jYXRpb24iLCJVc2VyU3ZjIiwicmVzcG9uc2UiLCIkZW1pdCIsInBhdGgiLCJyZWdpc3RlciIsInVzZXIiLCJjdXJyZW50VXNlciIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJodG1sNU1vZGUiLCJydW4iLCIkcm9vdFNjb3BlIiwiJHRpbWVvdXQiLCJjb25uZWN0IiwidXJsIiwiY29ubmVjdGlvbiIsIldlYlNvY2tldCIsIm9uY2xvc2UiLCJlIiwiY29uc29sZSIsImxvZyIsIm9ubWVzc2FnZSIsIl9yZWYiLCJfSlNPTiRwYXJzZSIsIkpTT04iLCJwYXJzZSIsInRvcGljIiwicGF5bG9hZCIsIiRicm9hZGNhc3QiXSwibWFwcGluZ3MiOiJBQUFBLFlDQUFBLFNBQUFDLE9BQUEsVUFDQSxZQ0RBRCxRQUNBQyxPQUFBLFVBQ0FDLFFBQUEsWUFBQSxRQUFBLFNBQUFDLEdBQ0FDLEtBQUFDLE1BQUEsV0FDQSxNQUFBRixHQUFBRyxJQUFBLGVBR0FGLEtBQUFHLE9BQUEsU0FBQUMsR0FDQSxNQUFBTCxHQUFBSyxLQUFBLGFBQUFBLE9DUkFSLFFBQ0FDLE9BQUEsVUFDQUMsUUFBQSxXQUFBLFFBQUEsU0FBQUMsR0FDQSxHQUFBTSxHQUFBTCxJQUVBSyxHQUFBQyxRQUFBLFdBQ0EsTUFBQVAsR0FBQUcsSUFBQSxlQUdBRyxFQUFBRSxNQUFBLFNBQUFDLEVBQUFDLEdBQ0EsTUFBQVYsR0FDQUssS0FBQSxpQkFDQUksU0FBQUEsRUFBQUMsU0FBQUEsSUFFQUMsS0FBQSxTQUFBQyxHQUdBLE1BRkFOLEdBQUFPLE1BQUFELEVBQUFFLEtBQ0FkLEVBQUFlLFNBQUFDLFFBQUFDLE9BQUEsVUFBQUwsRUFBQUUsS0FDQVIsRUFBQUMsYUFJQUQsRUFBQVksV0FBQSxTQUFBVCxFQUFBQyxHQUNBLE1BQUFWLEdBQ0FLLEtBQUEsY0FDQUksU0FBQUEsRUFBQUMsU0FBQUEsSUFFQUMsS0FBQSxTQUFBUSxHQUNBLE1BQUFiLFNDM0JBVCxRQUNBQyxPQUFBLFVBQ0FzQixXQUFBLGFBQUEsU0FBQSxXQUFBLFNBQUFDLEVBQUFDLEdBRUFBLEVBQ0FwQixRQUNBcUIsUUFBQSxTQUFBQyxHQUNBSCxFQUFBRyxNQUFBQSxJQUdBSCxFQUFBSSxRQUFBLFdBQ0FKLEVBQUFLLFVBQ0FKLEVBQ0FsQixRQUNBSyxTQUFBLGFBQ0FrQixLQUFBTixFQUFBSyxXQUVBSCxRQUFBLFNBQUFsQixHQUNBZ0IsRUFBQUssU0FBQSxRQUtBTCxFQUFBTyxJQUFBLGNBQUEsU0FBQUMsRUFBQXhCLEdBQ0FnQixFQUFBUyxPQUFBLFdBQ0FULEVBQUFHLE1BQUFPLFFBQUExQixVQ3pCQVIsUUFDQUMsT0FBQSxVQUNBc0IsV0FBQSxhQUFBLFNBQUEsWUFBQSxVQUFBLFNBQUFDLEVBQUFXLEVBQUFDLEdBQ0FaLEVBQUFiLE1BQUEsU0FBQUMsRUFBQUMsR0FDQXVCLEVBQ0F6QixNQUFBQyxFQUFBQyxHQUNBQyxLQUFBLFNBQUF1QixHQUNBYixFQUFBYyxNQUFBLFFBQUFELEVBQUFwQixNQUNBa0IsRUFBQUksS0FBQSxXQ1JBdkMsUUFDQUMsT0FBQSxVQUNBc0IsV0FBQSxnQkFBQSxTQUFBLFlBQUEsVUFBQSxTQUFBQyxFQUFBVyxFQUFBQyxHQUNBWixFQUFBZ0IsU0FBQSxTQUFBNUIsRUFBQUMsR0FDQXVCLEVBQ0FmLFdBQUFULEVBQUFDLEdBQ0FDLEtBQUEsU0FBQVEsR0FDQWMsRUFDQXpCLE1BQUFDLEVBQUFDLEdBQ0FDLEtBQUEsU0FBQUMsR0FBQSxNQUFBUyxHQUFBYyxNQUFBLFFBQUF2QixFQUFBRSxRQUNBSCxLQUFBLFdBQ0FVLEVBQUFaLFNBQUEsS0FDQVksRUFBQVgsU0FBQSxLQUNBc0IsRUFBQUksS0FBQSxhQ2JBdkMsUUFDQUMsT0FBQSxVQUNBc0IsV0FBQSxtQkFBQSxTQUFBLFNBQUFDLEdBQ0FBLEVBQUFPLElBQUEsUUFBQSxTQUFBQyxFQUFBUyxHQUNBakIsRUFBQWtCLFlBQUFELE9DSkF6QyxRQUNBQyxPQUFBLFVBQ0EwQyxRQUFBQSxpQkFBQUEsb0JBQUEsU0FBQUMsRUFBQUMsR0FDQUQsRUFDQUUsS0FBQSxLQUNBdkIsV0FBQSxZQUNBd0IsWUFBQSxlQUVBRCxLQUFBLGFBQ0F2QixXQUFBLGVBQ0F3QixZQUFBLGtCQUVBRCxLQUFBLFVBQ0F2QixXQUFBLFlBQ0F3QixZQUFBLGVBR0FGLEVBQUFHLFdBQUEsTUNqQkFoRCxRQUNBQyxPQUFBLFVBQ0FnRCxLQUFBQSxhQUFBQSxXQUFBLFNBQUFDLEVBQUFDLElBRUEsUUFBQUMsS0FDQSxHQUFBQyxHQUFBLHNCQUNBQyxFQUFBLEdBQUFDLFdBQUFGLEVBRUFDLEdBQUFFLFFBQUEsU0FBQUMsR0FDQUMsUUFBQUMsSUFBQSw4Q0FDQVIsRUFBQUMsRUFBQSxNQUdBRSxFQUFBTSxVQUFBLFNBQUFDLEdBQUEsR0FBQTVDLEdBQUE0QyxFQUFBNUMsS0FBQTZDLEVBQ0FDLEtBQUFDLE1BQUEvQyxHQUFBZ0QsRUFEQUgsRUFDQUcsTUFBQUMsRUFEQUosRUFDQUksT0FDQWhCLEdBQUFpQixXQUFBLE1BQUFGLEVBQUFDIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ3NvY2lhbCcsIFsnbmdSb3V0ZSddKTtcblxuYW5ndWxhci5tb2R1bGUoJ3NvY2lhbCcpLnNlcnZpY2UoJ1Bvc3RzU3ZjJywgZnVuY3Rpb24gKCRodHRwKSB7XG4gIHRoaXMuZmV0Y2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycpO1xuICB9O1xuXG4gIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24gKHBvc3QpIHtcbiAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9wb3N0cycsIHBvc3QpO1xuICB9O1xufSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdzb2NpYWwnKS5zZXJ2aWNlKCdVc2VyU3ZjJywgZnVuY3Rpb24gKCRodHRwKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICBzZWxmLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VycycpO1xuICB9O1xuXG4gIHNlbGYubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCB7XG4gICAgICB1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuICAgICAgc2VsZi50b2tlbiA9IHZhbC5kYXRhO1xuICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gdmFsLmRhdGE7XG4gICAgICByZXR1cm4gc2VsZi5nZXRVc2VyKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgc2VsZi5jcmVhdGVVc2VyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmRcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICByZXR1cm4gc2VsZjtcbiAgICB9KTtcbiAgICAvLyAudGhlbihyZXNwID0+IHtcbiAgICAvLyAgIHJldHVybiBzZWxmLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCk7XG4gICAgLy8gfSk7XG4gIH07XG59KTtcbmFuZ3VsYXIubW9kdWxlKCdzb2NpYWwnKS5jb250cm9sbGVyKCdQb3N0c0N0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCBQb3N0c1N2Yykge1xuXG4gIFBvc3RzU3ZjLmZldGNoKCkuc3VjY2VzcyhmdW5jdGlvbiAocG9zdHMpIHtcbiAgICAkc2NvcGUucG9zdHMgPSBwb3N0cztcbiAgfSk7XG5cbiAgJHNjb3BlLmFkZFBvc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCRzY29wZS5wb3N0Qm9keSkge1xuICAgICAgUG9zdHNTdmMuY3JlYXRlKHtcbiAgICAgICAgdXNlcm5hbWU6ICdiZXpyb25jemVrJyxcbiAgICAgICAgYm9keTogJHNjb3BlLnBvc3RCb2R5XG4gICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0KSB7XG4gICAgICAgICRzY29wZS5wb3N0Qm9keSA9IG51bGw7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgJHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbiAoXywgcG9zdCkge1xuICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgJHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdzb2NpYWwnKS5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIFVzZXJTdmMpIHtcbiAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIFVzZXJTdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHJlc3BvbnNlLmRhdGEpO1xuICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9KTtcbiAgfTtcbn0pO1xuYW5ndWxhci5tb2R1bGUoJ3NvY2lhbCcpLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgVXNlclN2Yykge1xuICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgVXNlclN2Yy5jcmVhdGVVc2VyKHVzZXJuYW1lLCBwYXNzd29yZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xuICAgICAgVXNlclN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLiRlbWl0KCdsb2dpbicsIHZhbC5kYXRhKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUudXNlcm5hbWUgPSBudWxsO1xuICAgICAgICAkc2NvcGUucGFzc3dvcmQgPSBudWxsO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG59KTtcbmFuZ3VsYXIubW9kdWxlKCdzb2NpYWwnKS5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlKSB7XG4gICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24gKF8sIHVzZXIpIHtcbiAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICB9KTtcbn0pO1xuYW5ndWxhci5tb2R1bGUoJ3NvY2lhbCcpLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XG4gICAgY29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsXG4gICAgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJ1xuICB9KS53aGVuKCcvcmVnaXN0ZXInLCB7XG4gICAgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ3RybCcsXG4gICAgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJ1xuICB9KS53aGVuKCcvbG9naW4nLCB7XG4gICAgY29udHJvbGxlcjogJ0xvZ2luQ3RybCcsXG4gICAgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJ1xuICB9KTtcblxuICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG59KTtcbmFuZ3VsYXIubW9kdWxlKCdzb2NpYWwnKS5ydW4oZnVuY3Rpb24gKCRyb290U2NvcGUsICR0aW1lb3V0KSB7XG5cbiAgKGZ1bmN0aW9uIGNvbm5lY3QoKSB7XG4gICAgdmFyIHVybCA9ICd3czovL2xvY2FsaG9zdDozMDAwJztcbiAgICB2YXIgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTtcblxuICAgIGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3Rpb24gbG9zdC4gUmVjb25uZWN0aW5nLi4uJyk7XG4gICAgICAkdGltZW91dChjb25uZWN0LCAxMCAqIDEwMDApO1xuICAgIH07XG5cbiAgICBjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChfcmVmKSB7XG4gICAgICB2YXIgZGF0YSA9IF9yZWYuZGF0YTtcblxuICAgICAgdmFyIF9KU09OJHBhcnNlID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgICAgdmFyIHRvcGljID0gX0pTT04kcGFyc2UudG9waWM7XG4gICAgICB2YXIgcGF5bG9hZCA9IF9KU09OJHBhcnNlLnBheWxvYWQ7XG5cbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnd3M6JyArIHRvcGljLCBwYXlsb2FkKTtcbiAgICB9O1xuICB9KSgpO1xufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3NvY2lhbCcsIFtcclxuICAnbmdSb3V0ZSdcclxuXSk7XHJcbiIsImFuZ3VsYXJcclxuLm1vZHVsZSgnc29jaWFsJylcclxuLnNlcnZpY2UoJ1Bvc3RzU3ZjJywgZnVuY3Rpb24gKCRodHRwKSB7XHJcbiAgdGhpcy5mZXRjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnKTtcclxuICB9O1xyXG5cclxuICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHBvc3QpIHtcclxuICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Bvc3RzJywgcG9zdCk7XHJcbiAgfVxyXG59KTtcclxuIiwiYW5ndWxhclxyXG4ubW9kdWxlKCdzb2NpYWwnKVxyXG4uc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICBzZWxmLmdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnKTtcclxuICB9O1xyXG5cclxuICBzZWxmLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICByZXR1cm4gJGh0dHBcclxuICAgICAgLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCB7XHJcbiAgICAgICAgdXNlcm5hbWUsIHBhc3N3b3JkXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHZhbCA9PiB7XHJcbiAgICAgICAgc2VsZi50b2tlbiA9IHZhbC5kYXRhO1xyXG4gICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHZhbC5kYXRhO1xyXG4gICAgICAgIHJldHVybiBzZWxmLmdldFVzZXIoKTtcclxuICAgICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgc2VsZi5jcmVhdGVVc2VyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgcmV0dXJuICRodHRwXHJcbiAgICAgIC5wb3N0KCcvYXBpL3VzZXJzJywge1xyXG4gICAgICAgIHVzZXJuYW1lLCBwYXNzd29yZFxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihyZXNwID0+IHtcclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgICAgfSk7XHJcbiAgICAgIC8vIC50aGVuKHJlc3AgPT4ge1xyXG4gICAgICAvLyAgIHJldHVybiBzZWxmLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCk7XHJcbiAgICAgIC8vIH0pO1xyXG4gIH1cclxufSk7IiwiYW5ndWxhclxyXG4ubW9kdWxlKCdzb2NpYWwnKVxyXG4uY29udHJvbGxlcignUG9zdHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBQb3N0c1N2Yykge1xyXG5cclxuICBQb3N0c1N2Y1xyXG4gICAgLmZldGNoKClcclxuICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHBvc3RzKSB7XHJcbiAgICAgICRzY29wZS5wb3N0cyA9IHBvc3RzO1xyXG4gICAgfSk7XHJcblxyXG4gICRzY29wZS5hZGRQb3N0ID0gKCkgPT4ge1xyXG4gICAgaWYoJHNjb3BlLnBvc3RCb2R5KSB7XHJcbiAgICAgIFBvc3RzU3ZjXHJcbiAgICAgICAgLmNyZWF0ZSh7XHJcbiAgICAgICAgICB1c2VybmFtZTogJ2JlenJvbmN6ZWsnLFxyXG4gICAgICAgICAgYm9keTogJHNjb3BlLnBvc3RCb2R5XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3VjY2Vzcyhwb3N0ID0+IHtcclxuICAgICAgICAgICRzY29wZS5wb3N0Qm9keSA9IG51bGw7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KSB7XHJcbiAgICAkc2NvcGUuJGFwcGx5KCgpID0+IHtcclxuICAgICAgJHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbn0pO1xyXG4iLCJhbmd1bGFyXHJcbi5tb2R1bGUoJ3NvY2lhbCcpXHJcbi5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCAoJHNjb3BlLCAkbG9jYXRpb24sIFVzZXJTdmMpID0+IHtcclxuICAkc2NvcGUubG9naW4gPSAodXNlcm5hbWUsIHBhc3N3b3JkKSA9PiB7XHJcbiAgICBVc2VyU3ZjXHJcbiAgICAgIC5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgcmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgICAgfSk7XHJcbiAgfTtcclxufSk7IiwiYW5ndWxhclxyXG4ubW9kdWxlKCdzb2NpYWwnKVxyXG4uY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAgVXNlclN2Yykge1xyXG4gICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgVXNlclN2Y1xyXG4gICAgICAuY3JlYXRlVXNlcih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgIC50aGVuKHJlc3AgPT4ge1xyXG4gICAgICAgIFVzZXJTdmNcclxuICAgICAgICAgIC5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAudGhlbih2YWwgPT4gJHNjb3BlLiRlbWl0KCdsb2dpbicsIHZhbC5kYXRhKSlcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJuYW1lID0gbnVsbDtcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkID0gbnVsbDtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICB9XHJcbn0pOyIsImFuZ3VsYXJcclxuLm1vZHVsZSgnc29jaWFsJylcclxuLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG4gICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oXywgdXNlcikge1xyXG4gICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcclxuICB9KTtcclxuXHJcblxyXG59KTsiLCJhbmd1bGFyXHJcbi5tb2R1bGUoJ3NvY2lhbCcpXHJcbi5jb25maWcoZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xyXG4gICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAud2hlbignLycsIHtcclxuICAgICAgY29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAncG9zdHMuaHRtbCdcclxuICAgIH0pXHJcbiAgICAud2hlbignL3JlZ2lzdGVyJywge1xyXG4gICAgICBjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJyxcclxuICAgICAgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJ1xyXG4gICAgfSlcclxuICAgIC53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnXHJcbiAgICB9KTtcclxuXHJcbiAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG59KTsiLCJhbmd1bGFyXHJcbi5tb2R1bGUoJ3NvY2lhbCcpXHJcbi5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHRpbWVvdXQpIHtcclxuXHJcbiAgKGZ1bmN0aW9uIGNvbm5lY3QoKSB7XHJcbiAgICBjb25zdCB1cmwgPSAnd3M6Ly9sb2NhbGhvc3Q6MzAwMCc7XHJcbiAgICBjb25zdCBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldCh1cmwpO1xyXG5cclxuICAgIGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdXZWJTb2NrZXQgY29ubmVjdGlvbiBsb3N0LiBSZWNvbm5lY3RpbmcuLi4nKTtcclxuICAgICAgJHRpbWVvdXQoY29ubmVjdCwgMTAqMTAwMCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24gKHtkYXRhfSkge1xyXG4gICAgICBjb25zdCB7dG9waWMsIHBheWxvYWR9ID0gSlNPTi5wYXJzZShkYXRhKTtcclxuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KGB3czoke3RvcGljfWAsIHBheWxvYWQpO1xyXG4gICAgfVxyXG4gIH0pKCk7XHJcblxyXG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
